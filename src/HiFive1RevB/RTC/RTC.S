# #######################################################################################################
# 编写者：tao
# 文件：RTC.S
# 日期：2020.8.17
# 文件作用：定义RTC管理的汇编函数
# #######################################################################################################

.equ RTC_CTRL_ADDR,0x10000040

.equ RTCCFG,0x00
.equ RTCLO,0x08
.equ RTCHO,0x0C
.equ RTCCS,0x10
.equ RTCCMP,0x20

# ############################################################################# #
# RTCCFG####################################################################### #
# ############################################################################# #

# ###################################################################### #
# RTCCheckIP############################################################ #
# ###################################################################### #
.section .text
.align 2
.globl RTCCheckIP

RTCCheckIP:
    addi sp,sp,-4
    sw t0,0(sp)

    li t0,RTC_CTRL_ADDR
    lw a0,RTCCFG(t0)

    srli a0,a0,28
    andi a0,a0,1

    lw t0,0(sp)
    addi sp,sp,4
    ret

# ###################################################################### #
# RTCEnableAlways####################################################### #
# ###################################################################### #
.section .text
.align 2
.globl RTCEnableAlways

RTCEnableAlways:
    addi sp,sp,-12
    sw t0,0(sp)
    sw t1,4(sp)
    sw t2,8(sp)

    li t2,1
    slli t2,t2,12

    li t0,RTC_CTRL_ADDR
    lw t1,RTCCFG(t0)

    or t1,t1,t2
    sw t1,RTCCFG(t0)

    lw t2,8(sp)
    lw t1,4(sp)
    lw t0,0(sp)
    addi sp,sp,12
    ret


# ###################################################################### #
# RTCDisableAlways###################################################### #
# ###################################################################### #
.section .text
.align 2
.globl RTCDisableAlways

RTCDisableAlways:
    addi sp,sp,-12
    sw t0,0(sp)
    sw t1,4(sp)
    sw t2,8(sp)

    li t2,1
    slli t2,t2,12

    li t0,RTC_CTRL_ADDR
    lw t1,RTCCFG(t0)

    or t1,t1,t2
    xor t1,t1,t2
    sw t1,RTCCFG(t0)

    lw t2,8(sp)
    lw t1,4(sp)
    lw t0,0(sp)
    addi sp,sp,12
    ret

# ###################################################################### #
# RTCSetScaleValue###################################################### #
# ###################################################################### #
.section .text
.align 2
.globl RTCSetScaleValue

RTCSetScaleValue:
    addi sp,sp,-12
    sw t0,0(sp)
    sw t1,4(sp)
    sw t2,8(sp)

    li t2,15
    andi a0,a0,15

    li t0,RTC_CTRL_ADDR
    lw t1,RTCCFG(t0)

    or t1,t1,t2
    xor t1,t1,t2

    or t1,t1,a0
    sw t1,RTCCFG(t0)

    lw t2,8(sp)
    lw t1,4(sp)
    lw t0,0(sp)
    addi sp,sp,12
    ret

# ############################################################################# #
# RTCLO######################################################################## #
# ############################################################################# #

# ###################################################################### #
# RTCReadLOValue######################################################## #
# ###################################################################### #
.section .text
.align 2
.globl RTCReadLOValue

RTCReadLOValue:
    addi sp,sp,-4
    sw t0,0(sp)

    li t0,RTC_CTRL_ADDR
    lw a0,RTCLO(t0)
    
    lw t0,0(sp)
    addi sp,sp,4
    ret

# ###################################################################### #
# RTCSetLOValue######################################################### #
# ###################################################################### #
.section .text
.align 2
.globl RTCSetLOValue

RTCSetLOValue:
    addi sp,sp,-4
    sw t0,0(sp)

    li t0,RTC_CTRL_ADDR
    sw a0,RTCLO(t0)

    lw t0,0(sp)
    addi sp,sp,4
    ret

# ############################################################################# #
# RTCHI######################################################################## #
# ############################################################################# #

# ###################################################################### #
# RTCReadHIValue######################################################## #
# ###################################################################### #
.section .text
.align 2
.globl RTCReadHIValue

RTCReadHIValue:
    addi sp,sp,-4
    sw t0,0(sp)

    li t0,RTC_CTRL_ADDR
    lw a0,RTCLO(t0)
    
    lw t0,0(sp)
    addi sp,sp,4
    ret

# ###################################################################### #
# RTCSetHIValue######################################################### #
# ###################################################################### #
.section .text
.align 2
.globl RTCSetHIValue

RTCSetHIValue:
    addi sp,sp,-4
    sw t0,0(sp)

    li t0,RTC_CTRL_ADDR
    sw a0,RTCLO(t0)

    lw t0,0(sp)
    addi sp,sp,4
    ret

# ############################################################################# #
# RTCCS######################################################################## #
# ############################################################################# #

# ###################################################################### #
# RTCReadCSL32Value##################################################### #
# ###################################################################### #
.section .text
.align 2
.globl RTCReadCSL32Value

RTCReadCSL32Value:
    addi sp,sp,-4
    sw t0,0(sp)

    li t0,RTC_CTRL_ADDR
    lw a0,RTCCS(t0)
    
    lw t0,0(sp)
    addi sp,sp,4
    ret

# ############################################################################# #
# RTCCMP####################################################################### #
# ############################################################################# #

# ###################################################################### #
# RTCSetCMPValue######################################################## #
# ###################################################################### #
.section .text
.align 2
.globl RTCSetCMPValue

RTCSetCMPValue:
    addi sp,sp,-4
    sw t0,0(sp)

    li t0,RTC_CTRL_ADDR
    sw a0,RTCCMP(t0)
    
    lw t0,0(sp)
    addi sp,sp,4
    ret

